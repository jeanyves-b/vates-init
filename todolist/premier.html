<html>
	<head>
		<meta charset="utf-8" />
		<title> to do list </title>
		<script src="http://underscorejs.org/underscore-min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
		<script src="http://backbonejs.org/backbone.js"></script>
	</head>

	<body>
		<div id="affichageformulaire"></div>
		<script type="text/template" id="formulaire"><br/>
			<form name="todoux">
				titre de la tache<br>
				<input type="text" name="titre" id="title"/><br><br>
				créateur de la tache<br>
				<input type="text" name="createur" id="creator"/><br><br>
				description<br>
				<textarea name="description" id="description" rows=4 cols=70></textarea><br>
				<input type="button" id="ajout" value="enregistrer"/>
				<input type="button" id="reset" value="reinitialiser"/><br><br>
			</form>
			<span><%= number %></span>
		</script>
		<div id="listdisplayer"></div>
		<p>tache enregistrée<br></p>
		<script type="text/template" id="tasktemplate"><br/>
			<!--<span><%= id %></span>
			<span><%= title %></span>
			<span><%= creator %></span>
			<span><%= datecreation %></span>
			<span><%= tags %></span>
			<span><%= task %></span>-->
		</script>
		<script>
			var number = 1;
			
			var Task = Backbone.Model.extend({
				defaults: {
					id : 0,
					title : "",
					creator : "",
					task : "",
					datecreation : "",
					datemodif : "",
					tags : [],
					dependance : []
				},
				initialize: function() {
					date = new Date();
					id = number;
					datecreation = date.getDate()+"/"+(date.getMonth()+1)+"/"+date.getFullYear();
					datemodif = date;
					
					this.on("change", function(model){
						date = new Date();
						datemodif = date.getDate()+"/"+(date.getMonth()+1)+"/"+date.getFullYear();
						console.log(datemodif);
					});
				}
			});
			
			formul = Backbone.View.extend({
				el: $("#affichageformulaire"),
				initialize: function(){
					this.template = _.template( $("#formulaire").html(), {});
				},
				render: function(){
					this.$el.html(this.template);
				},
				events: {
					"click #ajout": "doajout",
					"click #reset": "doreset",
				},
				doajout: function(event){
					var titre = document.forms["todoux"].elements["titre"],
						createur = document.forms["todoux"].elements["creator"],
						description = document.forms["todoux"].elements["description"],
						task = new Task({ title : titre, creator : createur, task : description});
					tasklist.add(Task, task);
					number += 1;
					this.doreset();
					this.render();
				},
				doreset: function(event){
					console.log("remise à zero");
				}
			});
			
			var TaskList = Backbone.Collection.extend({
				model: Task
			});
			
			DisplayList = Backbone.View.extend({
				el: $("#listdisplayer"),
				initialize: function(){
					this.template = _.template($("#tasktemplate").html(), {});
					_.bindAll(this, "Task");
					this.setModel(Task);
					this.model.bind("change", this.render);
				},
				setModel: function(model){
					this.model = model;
				},
				render: function(){
					var rendercontent = this.template(this.model.toJSON());
					this.$el.html(template);
					return this;
				}
			});
			
			var tasklist = new TaskList;
			var displist = new DisplayList;
			var view = new formul;
			view.render();
		</script>
	</body>
</html>
